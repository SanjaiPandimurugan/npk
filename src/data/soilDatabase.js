export const soilDatabase = {
  "Haryana": {
    districts: {
      "Ambala": {
        soil_types: ["Alluvial", "Sandy loam"],
        nutrients: {
          n_content: "3:1:4",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium-high"
        },
        deficiencies: ["Zn", "Fe"],
        rainfall: "800-900"
      },
      "Karnal": {
        soil_types: ["Alluvial", "Loamy"],
        nutrients: {
          n_content: "4:1:5",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium-high"
        },
        deficiencies: ["Zn"],
        rainfall: "650-750",
        suitable_crops: {
          "Sugarcane": {
            suitability: "high",
            season: "Year-round",
            yield_potential: "70-80 tonnes/ha"
          },
          "Cotton": {
            suitability: "high",
            season: "Kharif",
            yield_potential: "20-25 quintals/ha"
          }
        }
      },
      "Panipat": {
        soil_types: ["Alluvial", "Loamy"],
        nutrients: {
          n_content: "4:1:4",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "600-700"
      },
      "Sonipat": {
        soil_types: ["Alluvial", "Loamy"],
        nutrients: {
          n_content: "4:1:4",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "600-700"
      },
      "Rohtak": {
        soil_types: ["Alluvial", "Loamy"],
        nutrients: {
          n_content: "4:1:4",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "B"],
        rainfall: "500-600"
      },
      "Jhajjar": {
        soil_types: ["Alluvial", "Loamy"],
        nutrients: {
          n_content: "4:1:4",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "500-600"
      },
      "Faridabad": {
        soil_types: ["Alluvial", "Light textured (loamy-sandy)"],
        nutrients: {
          n_content: "3:1:4",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "500-600"
      },
      "Palwal": {
        soil_types: ["Alluvial", "Light textured (loamy-sandy)"],
        nutrients: {
          n_content: "3:1:4",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "500-600"
      },
      "Gurugram": {
        soil_types: ["Alluvial", "Light textured (loamy-sandy)", "Aridic spots"],
        nutrients: {
          n_content: "6:1:7",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "Fe"],
        rainfall: "450-550"
      },
      "Nuh": {
        soil_types: ["Sandy loam", "Aridic conditions"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "B"],
        rainfall: "400-500"
      },
      "Rewari": {
        soil_types: ["Sandy loam", "Aridic conditions"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "B"],
        rainfall: "400-500"
      },
      "Mahendragarh": {
        soil_types: ["Sandy loam", "Aridic conditions"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "B"],
        rainfall: "350-450"
      },
      "Bhiwani": {
        soil_types: ["Sandy loam to sandy", "Aridic conditions"],
        nutrients: {
          n_content: "5:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "300-450"
      },
      "Jind": {
        soil_types: ["Alluvial", "Loamy"],
        nutrients: {
          n_content: "7:1:7",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "500-600"
      },
      "Hisar": {
        soil_types: ["Alluvial to slightly sandy loam"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "300-500"
      },
      "Fatehabad": {
        soil_types: ["Alluvial", "Light textured"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "300-500"
      },
      "Sirsa": {
        soil_types: ["Sandy loam", "Aridic conditions"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "200-300"
      },
      "Charkhi Dadri": {
        soil_types: ["Sandy loam to sandy", "Aridic conditions"],
        nutrients: {
          n_content: "5:1:6",
          n_status: "low-medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "300-400"
      }
    }
  },
  "Tamil Nadu": {
    districts: {
      "Chennai": {
        soil_types: ["Coastal alluvial", "Sandy loam"],
        nutrients: {
          n_content: "7:1:7",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "1200-1300"
      },
      "Coimbatore": {
        soil_types: ["Red soils", "Black soils"],
        nutrients: {
          n_content: "6:1:7",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "Fe"],
        rainfall: "600-700"
      },
      "Dindigul": {
        soil_types: ["Red soils", "Black soils"],
        nutrients: {
          n_content: "6:1:7",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "B"],
        rainfall: "700-900"
      },
      "Erode": {
        soil_types: ["Red soils", "Black soils"],
        nutrients: {
          n_content: "6:1:7",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "600-700"
      },
      "Kanchipuram": {
        soil_types: ["Coastal alluvial", "Red sandy"],
        nutrients: {
          n_content: "7:1:7",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "1000-1200"
      },
      "Kanniyakumari": {
        soil_types: ["Lateritic", "Red loam", "Coastal"],
        nutrients: {
          n_content: "7:1:7",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "Fe"],
        rainfall: "1400-1800"
      },
      "Karur": {
        soil_types: ["Red soils", "Black soils"],
        nutrients: {
          n_content: "6:1:7",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "600-700"
      },
      "Krishnagiri": {
        soil_types: ["Red loamy", "Lateritic soils"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "B"],
        rainfall: "750-900"
      },
      "Madurai": {
        soil_types: ["Red soils", "Black soils"],
        nutrients: {
          n_content: "6:1:7",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "850-950"
      },
      "Mayiladuthurai": {
        soil_types: ["Alluvial", "Deltaic soils"],
        nutrients: {
          n_content: "7:1:8",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium-high"
        },
        deficiencies: ["Zn"],
        rainfall: "1000-1200"
      },
      "Nagapattinam": {
        soil_types: ["Coastal alluvial", "Deltaic soils"],
        nutrients: {
          n_content: "7:1:8",
          n_status: "medium",
          p_status: "medium",
          k_status: "medium-high"
        },
        deficiencies: ["Zn"],
        rainfall: "1000-1300"
      },
      "Namakkal": {
        soil_types: ["Red soils", "Black soils"],
        nutrients: {
          n_content: "6:1:7",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "700-800"
      },
      "Nilgiris": {
        soil_types: ["Mountainous", "Acidic", "Well-drained"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn", "B", "Fe"],
        rainfall: "1500-2000"
      },
      "Perambalur": {
        soil_types: ["Red soils", "Black soils"],
        nutrients: {
          n_content: "6:1:6",
          n_status: "medium",
          p_status: "low-medium",
          k_status: "medium"
        },
        deficiencies: ["Zn"],
        rainfall: "800-900"
      }
    }
  }
};

// Export these as named exports
export const deficiencyManagement = {
  "Zn": {
    symptoms: "Interveinal chlorosis",
    correction: "Apply zinc sulfate @ 25 kg/ha"
  },
  "Fe": {
    symptoms: "Yellowing of young leaves",
    correction: "Foliar spray of ferrous sulfate"
  },
  "B": {
    symptoms: "Growing point die back",
    correction: "Apply borax @ 10 kg/ha"
  }
};

export const nutrientStatus = {
  "Nitrogen": {
    low: "< 150 kg/ha",
    medium: "150-250 kg/ha",
    high: "> 250 kg/ha"
  },
  "Phosphorus": {
    low: "< 10 kg/ha",
    medium: "10-25 kg/ha",
    high: "> 25 kg/ha"
  },
  "Potassium": {
    low: "< 150 kg/ha",
    medium: "150-400 kg/ha",
    high: "> 400 kg/ha"
  }
};

export const calculateFertilizerRecommendation = (crop, soilData, landArea) => {
  try {
    // Input validation
    if (!crop || !soilData || !landArea) {
      console.error("Missing required parameters:", { crop, soilData, landArea });
      throw new Error("Missing required input data");
    }

    if (!soilData.nutrients || !soilData.nutrients.n_content) {
      console.error("Invalid soil data structure:", soilData);
      throw new Error("Invalid soil data");
    }

    // Parse the NPK ratio
    const currentRatio = soilData.nutrients.n_content;
    const [n, p, k] = currentRatio.split(':').map(num => parseInt(num, 10));

    if (isNaN(n) || isNaN(p) || isNaN(k)) {
      console.error("Invalid NPK ratio:", currentRatio);
      throw new Error("Invalid NPK ratio format");
    }

    // Base calculations
    const baseValues = {
      n: n * 50,  // Scale up the ratio to actual values
      p: p * 50,
      k: k * 50
    };

    // Standard required values
    const required = {
      n: 250,  // Example values - adjust based on crop
      p: 125,
      k: 100
    };

    // Calculate deficits
    const deficit = {
      n: Math.max(0, required.n - baseValues.n),
      p: Math.max(0, required.p - baseValues.p),
      k: Math.max(0, required.k - baseValues.k)
    };

    return {
      npk_analysis: {
        required: "5:2:3",  // Standard ratio
        current: currentRatio,
        deficit: `${Math.round(deficit.n/50)}:${Math.round(deficit.p/50)}:${Math.round(deficit.k/50)}`
      },
      fertilizers: {
        urea: Math.round(deficit.n * 2.17 * landArea),
        dap: Math.round(deficit.p * 5.43 * landArea),
        mop: Math.round(deficit.k * 1.67 * landArea)
      },
      organic: {
        fym: Math.round(10000 * landArea / 1000),
        vermicompost: Math.round(5000 * landArea / 1000),
        neem_cake: Math.round(500 * landArea / 1000)
      }
    };
  } catch (error) {
    console.error("Calculation error details:", error);
    throw new Error("Error calculating recommendations. Please check your inputs.");
  }
};

// Helper function to convert range to ratio
const convertRangeToRatio = (n, p, k) => {
  const minValue = Math.min(n, p, k);
  return {
    n: Math.round(n/minValue),
    p: Math.round(p/minValue),
    k: Math.round(k/minValue)
  };
};